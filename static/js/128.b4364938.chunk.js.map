{"version":3,"sources":["routes/posts/2021/09/12-1514-Mermaid-And-Mdx/document.mdx"],"names":["readingTime","text","minutes","time","words","layoutProps","MDXLayout","MDXContent","_ref","components","props","Object","_home_runner_work_mzvast_github_io_mzvast_github_io_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__","_mdx_js_react__WEBPACK_IMPORTED_MODULE_2__","assign","mdxType","id","parentName","href","className","data-language","data-highlighted-line-numbers","dangerouslySetInnerHTML","__html","mdx_mermaid_lib_Mermaid__WEBPACK_IMPORTED_MODULE_3__","chart","isMDXComponent","tableOfContents","arguments","length","undefined","level","title","children","frontMatter"],"mappings":"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","file":"static/js/128.b4364938.chunk.js","sourcesContent":["\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"2 min read\",\"minutes\":1.345,\"time\":80700,\"words\":269}\n/* @jsx mdx */\nimport { Mermaid } from 'mdx-mermaid/lib/Mermaid';\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h2 {...{\n      \"id\": \"mermaid\"\n    }}>{`Mermaid`}</h2>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://github.com/mermaid-js/mermaid\"\n      }}>{`Mermaid`}</a>{`是一款用代码绘制UML图的开源库。\n依赖少（纯JS），学习曲线平滑，很适合上手。再加上JS编写的跨端优势，更容易集成到其他项目中。`}</p>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://github.com/mermaid-js/mermaid-live-editor\"\n      }}>{`Mermaid Live Editor`}</a>{`可以在线使用。`}</p>\n    <p>{`可以简单看一下Mermaid依赖的库。用到了`}<inlineCode parentName=\"p\">{`d3`}</inlineCode>{`作为图形库，`}<inlineCode parentName=\"p\">{`dagre-d3`}</inlineCode>{`用于有向布局，`}<inlineCode parentName=\"p\">{`graphlib`}</inlineCode>{`提供数据结构存储,`}<inlineCode parentName=\"p\">{`khroma`}</inlineCode>{`用于AI智能色彩管理，`}<inlineCode parentName=\"p\">{`moment-mini`}</inlineCode>{`lite版本的momentjs，`}<inlineCode parentName=\"p\">{`stylis`}</inlineCode>{`CSS库\n可以说看这几个依赖已经感觉很强了。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\",\n        \"data-language\": \"json\",\n        \"data-highlighted-line-numbers\": \"\",\n        \"dangerouslySetInnerHTML\": {\n          \"__html\": \"<span class=\\\"token property\\\">\\\"dependencies\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\"@braintree/sanitize-url\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"^3.1.0\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"d3\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"^7.0.0\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"dagre\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"^0.8.5\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"dagre-d3\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"^0.6.4\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"dompurify\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"2.3.1\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"graphlib\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"^2.1.8\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"khroma\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"^1.4.1\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"moment-mini\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"^2.24.0\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"stylis\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"^4.0.10\\\"</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n\"\n        }\n      }}></code></pre>\n    <h2 {...{\n      \"id\": \"如何改造mdx-loader支持mdx-mermaid\"\n    }}>{`如何改造mdx-loader支持mdx-mermaid`}</h2>\n    <p>{`本文不是讲如何使用Mermaid绘图，而是侧重在将其和MDX进行整合，从而优化写作体验。`}</p>\n    <p>{`下面这幅图就是mdx渲染出来的。本blog的mdx与mermaid自上而下依赖关系如下。`}</p>\n    <Mermaid chart={`graph TD;\n    react-scripts-mdx -->mdx-loader;\n    mdx-loader-->mdx-mermai;`} mdxType=\"Mermaid\" />\n    <p>{`在实际接入过程中就遇到了挑战。`}</p>\n    <h3 {...{\n      \"id\": \"首先，在mdx-loader增加插件\"\n    }}>{`首先，在mdx-loader增加插件`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-jsx\",\n        \"data-language\": \"jsx\",\n        \"data-highlighted-line-numbers\": \"\",\n        \"dangerouslySetInnerHTML\": {\n          \"__html\": \"diff <span class=\\\"token operator\\\">--</span>git a<span class=\\\"token operator\\\">/</span>node_modules<span class=\\\"token operator\\\">/</span>mdx<span class=\\\"token operator\\\">-</span>loader<span class=\\\"token operator\\\">/</span>index<span class=\\\"token punctuation\\\">.</span>js b<span class=\\\"token operator\\\">/</span>node_modules<span class=\\\"token operator\\\">/</span>mdx<span class=\\\"token operator\\\">-</span>loader<span class=\\\"token operator\\\">/</span>index<span class=\\\"token punctuation\\\">.</span>js\\nindex <span class=\\\"token number\\\">60</span>c954a<span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>bc0c9a6 <span class=\\\"token number\\\">100644</span>\\n<span class=\\\"token operator\\\">--</span><span class=\\\"token operator\\\">-</span> a<span class=\\\"token operator\\\">/</span>node_modules<span class=\\\"token operator\\\">/</span>mdx<span class=\\\"token operator\\\">-</span>loader<span class=\\\"token operator\\\">/</span>index<span class=\\\"token punctuation\\\">.</span>js\\n<span class=\\\"token operator\\\">++</span><span class=\\\"token operator\\\">+</span> b<span class=\\\"token operator\\\">/</span>node_modules<span class=\\\"token operator\\\">/</span>mdx<span class=\\\"token operator\\\">-</span>loader<span class=\\\"token operator\\\">/</span>index<span class=\\\"token punctuation\\\">.</span>js\\n@@ <span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">10</span><span class=\\\"token punctuation\\\">,</span><span class=\\\"token number\\\">6</span> <span class=\\\"token operator\\\">+</span><span class=\\\"token number\\\">10</span><span class=\\\"token punctuation\\\">,</span><span class=\\\"token number\\\">7</span> @@ <span class=\\\"token keyword\\\">const</span> mdxExportJSONByDefault <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'mdx-constant'</span><span class=\\\"token punctuation\\\">)</span>\\n <span class=\\\"token keyword\\\">const</span> grayMatter <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'gray-matter'</span><span class=\\\"token punctuation\\\">)</span>\\n <span class=\\\"token keyword\\\">const</span> typography <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'./typography'</span><span class=\\\"token punctuation\\\">)</span>\\n <span class=\\\"token keyword\\\">const</span> rehypePrism <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'./prism'</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"highlighted-line\\\"><span class=\\\"token operator\\\">+</span><span class=\\\"token keyword\\\">const</span> mdxMermaid <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'mdx-mermaid'</span><span class=\\\"token punctuation\\\">)</span></span> \\n module<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function-variable function\\\">exports</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">source</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n   <span class=\\\"token keyword\\\">let</span> result\\n@@ <span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">18</span><span class=\\\"token punctuation\\\">,</span><span class=\\\"token number\\\">6</span> <span class=\\\"token operator\\\">+</span><span class=\\\"token number\\\">19</span><span class=\\\"token punctuation\\\">,</span><span class=\\\"token number\\\">7</span> @@ module<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function-variable function\\\">exports</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">source</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n   <span class=\\\"token keyword\\\">const</span> options <span class=\\\"token operator\\\">=</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">assign</span><span class=\\\"token punctuation\\\">(</span>\\n     <span class=\\\"token punctuation\\\">{</span>\\n       remarkPlugins<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n<span class=\\\"highlighted-line\\\"><span class=\\\"token operator\\\">+</span>        mdxMermaid<span class=\\\"token punctuation\\\">,</span></span>         slug<span class=\\\"token punctuation\\\">,</span>\\n         images<span class=\\\"token punctuation\\\">,</span> \\n         emoji<span class=\\\"token punctuation\\\">,</span>\\n\"\n        }\n      }}></code></pre>\n    <p>{`接入完成后，竟然ts报错了，提示`}<inlineCode parentName=\"p\">{`mdx-mermaid/Mermaid`}</inlineCode>{`不能resolve。这就很困惑了。\n于是就去看node_modules，他的package.json如下`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\",\n        \"data-language\": \"json\",\n        \"data-highlighted-line-numbers\": \"\",\n        \"dangerouslySetInnerHTML\": {\n          \"__html\": \"<span class=\\\"token property\\\">\\\"name\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"mdx-mermaid\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token property\\\">\\\"version\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"1.1.0\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token property\\\">\\\"description\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Display mermaid diagrams in mdx files.\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token property\\\">\\\"types\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"index.d.ts\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token property\\\">\\\"main\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"lib/mdxast-mermaid.js\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token property\\\">\\\"exports\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\".\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"./lib/mdxast-mermaid.js\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"./Mermaid\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"./lib/Mermaid.js\\\"</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n\"\n        }\n      }}></code></pre>\n    <p>{`首先这个mdx-mermaid包在package.json中定义了exports字段，其中将`}<inlineCode parentName=\"p\">{`./lib`}</inlineCode>{`导出成`}<inlineCode parentName=\"p\">{`./`}</inlineCode>{`,`}<inlineCode parentName=\"p\">{`./lib/Mermaid.js`}</inlineCode>{`导出成`}<inlineCode parentName=\"p\">{`./Mermaid`}</inlineCode>{`。\n经过一番调查，发现`}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/microsoft/TypeScript/issues/33079\"\n      }}>{`TS还没实现这个功能`}</a>{`。`}</p>\n    <p>{`那我们就得把引用关系给改一下，接下来定位是什么地方写死的呢。`}</p>\n    <h3 {...{\n      \"id\": \"改造mdx-mermail\"\n    }}>{`改造mdx-mermail`}</h3>\n    <p>{`mdxast-mermaid很明显是一个babel插件，通过对代码parse再transform输出改造后的代码。`}</p>\n    <p>{`可以看到visit遍历文件，如果引入了Mermai，就不处理，否则，就增加一条import记录。问题就出在这个路径ts不认。`}</p>\n    <p>{`就改对就行了。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-jsx\",\n        \"data-language\": \"jsx\",\n        \"data-highlighted-line-numbers\": \"\",\n        \"dangerouslySetInnerHTML\": {\n          \"__html\": \"diff <span class=\\\"token operator\\\">--</span>git a<span class=\\\"token operator\\\">/</span>node_modules<span class=\\\"token operator\\\">/</span>mdx<span class=\\\"token operator\\\">-</span>mermaid<span class=\\\"token operator\\\">/</span>lib<span class=\\\"token operator\\\">/</span>mdxast<span class=\\\"token operator\\\">-</span>mermaid<span class=\\\"token punctuation\\\">.</span>js b<span class=\\\"token operator\\\">/</span>node_modules<span class=\\\"token operator\\\">/</span>mdx<span class=\\\"token operator\\\">-</span>mermaid<span class=\\\"token operator\\\">/</span>lib<span class=\\\"token operator\\\">/</span>mdxast<span class=\\\"token operator\\\">-</span>mermaid<span class=\\\"token punctuation\\\">.</span>js\\nindex dbc38e4<span class=\\\"token punctuation\\\">.</span><span class=\\\"token punctuation\\\">.</span>e9872d4 <span class=\\\"token number\\\">100644</span>\\n<span class=\\\"token operator\\\">--</span><span class=\\\"token operator\\\">-</span> a<span class=\\\"token operator\\\">/</span>node_modules<span class=\\\"token operator\\\">/</span>mdx<span class=\\\"token operator\\\">-</span>mermaid<span class=\\\"token operator\\\">/</span>lib<span class=\\\"token operator\\\">/</span>mdxast<span class=\\\"token operator\\\">-</span>mermaid<span class=\\\"token punctuation\\\">.</span>js\\n<span class=\\\"token operator\\\">++</span><span class=\\\"token operator\\\">+</span> b<span class=\\\"token operator\\\">/</span>node_modules<span class=\\\"token operator\\\">/</span>mdx<span class=\\\"token operator\\\">-</span>mermaid<span class=\\\"token operator\\\">/</span>lib<span class=\\\"token operator\\\">/</span>mdxast<span class=\\\"token operator\\\">-</span>mermaid<span class=\\\"token punctuation\\\">.</span>js\\n@@ <span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">33</span><span class=\\\"token punctuation\\\">,</span><span class=\\\"token number\\\">7</span> <span class=\\\"token operator\\\">+</span><span class=\\\"token number\\\">33</span><span class=\\\"token punctuation\\\">,</span><span class=\\\"token number\\\">7</span> @@ <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">plugin</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">config</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n         <span class=\\\"token comment\\\">// See if there is already an import for the Mermaid component</span>\\n         <span class=\\\"token keyword\\\">let</span> importFound <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n         unist_util_visit_1<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">default</span><span class=\\\"token punctuation\\\">(</span>ast<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'import'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">node</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n<span class=\\\"token operator\\\">-</span>            <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token regex\\\">/\\\\s*import\\\\s*{\\\\s*Mermaid\\\\s*}\\\\s*from\\\\s*'mdx-mermaid\\\\/Mermaid'\\\\s*;?\\\\s*/</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">test</span><span class=\\\"token punctuation\\\">(</span>node<span class=\\\"token punctuation\\\">.</span>value<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n<span class=\\\"highlighted-line\\\"><span class=\\\"token operator\\\">+</span>            <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token regex\\\">/\\\\s*import\\\\s*{\\\\s*Mermaid\\\\s*}\\\\s*from\\\\s*'mdx-mermaid\\\\/lib\\\\/Mermaid'\\\\s*;?\\\\s*/</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">test</span><span class=\\\"token punctuation\\\">(</span>node<span class=\\\"token punctuation\\\">.</span>value<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span></span>                 importFound <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">;</span>\\n                 <span class=\\\"token keyword\\\">return</span> unist_util_visit_1<span class=\\\"token punctuation\\\">.</span>default<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">EXIT</span><span class=\\\"token punctuation\\\">;</span>\\n             <span class=\\\"token punctuation\\\">}</span>\\n@@ <span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">42</span><span class=\\\"token punctuation\\\">,</span><span class=\\\"token number\\\">7</span> <span class=\\\"token operator\\\">+</span><span class=\\\"token number\\\">42</span><span class=\\\"token punctuation\\\">,</span><span class=\\\"token number\\\">7</span> @@ <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">plugin</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">config</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n         <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>importFound<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n             ast<span class=\\\"token punctuation\\\">.</span>children<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">splice</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n                 type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'import'</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token operator\\\">-</span>                value<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'import { Mermaid } from \\\\'mdx-mermaid/Mermaid\\\\';'</span>\\n<span class=\\\"highlighted-line\\\"><span class=\\\"token operator\\\">+</span>                value<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'import { Mermaid } from \\\\'mdx-mermaid/lib/Mermaid\\\\';'</span></span>             <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n         <span class=\\\"token punctuation\\\">}</span>\\n     <span class=\\\"token punctuation\\\">}</span>\\n\"\n        }\n      }}></code></pre>\n    <h2 {...{\n      \"id\": \"patch-package的使用\"\n    }}>{`patch-package的使用`}</h2>\n    <p>{`一开始我说clone了两个代码库，本地通过yalc打包发布，调通。并给作者提了issue和PR`}</p>\n    <p>{`但问题是假如PR没有被合入，那如何在其他设备上同步我的“魔改”呢？`}</p>\n    <p>{`下面就要请出主角`}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ds300/patch-package\"\n      }}>{`patch-package`}</a>{`,`}</p>\n    <p>{`简单概括一下就是`}</p>\n    <p>{`1、先在node_modules里面直接修改代码`}</p>\n    <p>{`2、通过`}<inlineCode parentName=\"p\">{`npx patch-package 包名`}</inlineCode>{`的方式产生patch文件（根目录的patches文件夹下）`}</p>\n    <p>{`3、确保package.json中的postinstall存在patch应用的代码（如下）`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-jsx\",\n        \"data-language\": \"jsx\",\n        \"data-highlighted-line-numbers\": \"\",\n        \"dangerouslySetInnerHTML\": {\n          \"__html\": \"<span class=\\\"token string\\\">\\\"scripts\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n<span class=\\\"highlighted-line\\\"><span class=\\\"token operator\\\">+</span>  <span class=\\\"token string\\\">\\\"postinstall\\\"</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"npx patch-package\\\"</span></span> <span class=\\\"token punctuation\\\">}</span>\\n\"\n        }\n      }}></code></pre>\n    <p>{`上面的两处修正我都是直接在node_modules里面改的，并且fork了代码库提交了issue和PR。`}</p>\n    <p>{`感觉这样比用yalc修复bug的效率高多了呢。你觉得呢？`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"mermaid\",\n    level: 2,\n    title: \"Mermaid\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"如何改造mdx-loader支持mdx-mermaid\",\n    level: 2,\n    title: \"如何改造mdx-loader支持mdx-mermaid\",\n    children: [\n        {\n              id: \"首先，在mdx-loader增加插件\",\n              level: 3,\n              title: \"首先，在mdx-loader增加插件\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"改造mdx-mermail\",\n              level: 3,\n              title: \"改造mdx-mermail\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"patch-package的使用\",\n    level: 2,\n    title: \"patch-package的使用\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n"],"sourceRoot":""}