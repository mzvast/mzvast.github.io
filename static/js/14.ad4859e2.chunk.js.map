{"version":3,"sources":["routes/posts/2021/12/27-2027-Fix-Git-Merge-Mis-Deleting-files/document.mdx","routes/posts/2021/12/27-2027-Fix-Git-Merge-Mis-Deleting-files/assets/1.png"],"names":["readingTime","text","minutes","time","words","layoutProps","MDXLayout","MDXContent","_ref","components","props","Object","_home_runner_work_mzvast_github_io_mzvast_github_io_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__","_mdx_js_react__WEBPACK_IMPORTED_MODULE_2__","assign","mdxType","id","parentName","href","src","s1","style","width","isMDXComponent","tableOfContents","arguments","length","undefined","level","title","children","frontMatter","module","exports","__webpack_require__","p"],"mappings":"uTAGaA,EAAc,CAACC,KAAO,aAAaC,QAAU,KAAMC,KAAO,MAAMC,MAAQ,IAS/EC,EAAc,GAGdC,EAAY,UACH,SAASC,EAATC,GAGZ,IAFDC,EAECD,EAFDC,WACGC,EACFC,OAAAC,EAAA,EAAAD,CAAAH,EAAA,gBACD,OAAOG,OAAAE,EAAA,EAAAF,CAACL,EAADK,OAAAG,OAAA,GAAeT,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYM,QAAQ,cAE5EJ,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,0DADR,0DAGAL,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,gBADR,gBAGAL,OAAAE,EAAA,EAAAF,CAAA,oFAAmBA,OAAAE,EAAA,EAAAF,CAAA,IAAAA,OAAAG,OAAA,CAAGG,WAAW,KAAQ,CACrCC,KAAQ,sDADO,kCAAnB,wRAGAP,OAAAE,EAAA,EAAAF,CAAA,icACAA,OAAAE,EAAA,EAAAF,CAAA,yNACAA,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,0DADR,0DAGAL,OAAAE,EAAA,EAAAF,CAAA,2IACAA,OAAAE,EAAA,EAAAF,CAAA,mcAEAA,OAAAE,EAAA,EAAAF,CAAA,4JACAA,OAAAE,EAAA,EAAAF,CAAA,OAAKQ,IAAKC,IAAIC,MAAO,CACnBC,MAAO,UAETX,OAAAE,EAAA,EAAAF,CAAA,6FACAA,OAAAE,EAAA,EAAAF,CAAA,WAAKA,OAAAE,EAAA,EAAAF,CAAA,OAAAA,OAAAG,OAAA,CAAMG,WAAW,OAAU,IAA3B,oDAILN,OAAAE,EAAA,EAAAF,CAAA,sKACAA,OAAAE,EAAA,EAAAF,CAAA,yKACAA,OAAAE,EAAA,EAAAF,CAAA,iPACAA,OAAAE,EAAA,EAAAF,CAAA,sEACAA,OAAAE,EAAA,EAAAF,CAAA,oHACAA,OAAAE,EAAA,EAAAF,CAAA,2IAA6BA,OAAAE,EAAA,EAAAF,CAAA,cAAYM,WAAW,KAAvB,gBAA7B,4BAA8FN,OAAAE,EAAA,EAAAF,CAAA,cAAYM,WAAW,KAAvB,oBAA9F,6KACAN,OAAAE,EAAA,EAAAF,CAAA,yHACAA,OAAAE,EAAA,EAAAF,CAAA,+JAA4CA,OAAAE,EAAA,EAAAF,CAAA,cAAYM,WAAW,KAAvB,mCAA5C,UACAN,OAAAE,EAAA,EAAAF,CAAA,iLAA+CA,OAAAE,EAAA,EAAAF,CAAA,cAAYM,WAAW,KAAvB,0CAA/C,0DACAN,OAAAE,EAAA,EAAAF,CAAA,mFACAA,OAAAE,EAAA,EAAAF,CAAA,SAAGA,OAAAE,EAAA,EAAAF,CAAA,cAAYM,WAAW,KAAvB,qRAAH,UACAN,OAAAE,EAAA,EAAAF,CAAA,wEAAiBA,OAAAE,EAAA,EAAAF,CAAA,cAAYM,WAAW,KAAvB,kBAAjB,qDAAyFN,OAAAE,EAAA,EAAAF,CAAA,cAAYM,WAAW,KAAvB,qBAAzF,6CAAiKN,OAAAE,EAAA,EAAAF,CAAA,cAAYM,WAAW,KAAvB,yDACjKN,OAAAE,EAAA,EAAAF,CAAA,6DAAgBA,OAAAE,EAAA,EAAAF,CAAA,cAAYM,WAAW,KAAvB,eAAhB,sHACAN,OAAAE,EAAA,EAAAF,CAAA,KAAQ,CACNK,GAAM,gBADR,gBAGAL,OAAAE,EAAA,EAAAF,CAAA,gKACAA,OAAAE,EAAA,EAAAF,CAAA,2QAKJJ,EAAWgB,gBAAiB,EACrB,IAAMC,EAAkB,WAAAC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,SAAmB,CAChD,CACET,GAAI,yDACJY,MAAO,EACPC,MAAO,yDACPC,SAAU,CACN,CACMd,GAAI,eACJY,MAAO,EACPC,MAAO,eACPC,SAAU,IAIlB,CACQd,GAAI,yDACJY,MAAO,EACPC,MAAO,yDACPC,SAAU,IAIlB,CACQd,GAAI,eACJY,MAAO,EACPC,MAAO,eACPC,SAAU,QAQXC,EAAc,wBCzG3BC,EAAAC,QAAiBC,EAAAC,EAAuB","file":"static/js/14.ad4859e2.chunk.js","sourcesContent":["\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"1 min read\",\"minutes\":0.385,\"time\":23100,\"words\":77}\n/* @jsx mdx */\nimport s1 from './assets/1.png';\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h2 {...{\n      \"id\": \"你可以从本文了解到\"\n    }}>{`你可以从本文了解到`}</h2>\n    <h3 {...{\n      \"id\": \"背景\"\n    }}>{`背景`}</h3>\n    <p>{`看到了一片其他团队的关于`}<a parentName=\"p\" {...{\n        \"href\": \"https://mp.weixin.qq.com/s/UtTVKA5kZ7RXTNAQupczeg\"\n      }}>{`冲代码的文`}</a>{`，这篇文章做了一些分析和定位问题，但是没有给出特别好的拯救办法。本文结合实际经验，进行补充。`}</p>\n    <p>{`咱们有一个项目，有很多人在不同的分支上开发。有一天，A 同学提交了一个 merge 提交，这个 merge 把其他人的代码删除了。在不知道的情况下，大家又默默开发了好几天。`}</p>\n    <p>{`最后，这个问题被发现了，然后大家很着急，不知道该怎么还原被删的代码。`}</p>\n    <h3 {...{\n      \"id\": \"问题分析和方案比较\"\n    }}>{`问题分析和方案比较`}</h3>\n    <p>{`首先，为什么提交前后代码都可以编译通过呢？`}</p>\n    <p>{`1、A 在开发的时候，肯定代码是可以跑的。\n2、merge 合入主干后，别人的代码被删了，理论上，也有一定概率可以跑的（被删的代码是静态资源或者没有被什么依赖到）。`}</p>\n    <p>{`然后，回到灾难现场。现在的 git 提交是个什么情况呢？`}</p>\n    <img src={s1} style={{\n      width: '100%'\n    }} />\n    <p>{`简化成如下，a比b少了一堆文件`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`a [merge 节点]\n｜\\\\ b\n｜ |c\n`}</code></pre>\n    <p>{`假如a提交是一个普通提交，那么我们只需要revert a提交即可。`}</p>\n    <p>{`但是a这个merge提交不携带任何信息，不能revert。该如何修复呢？`}</p>\n    <p>{`有很多方法，不同的方法复杂度不一样。其中咱们采用的是如下的方法。其思路如下。`}</p>\n    <p>{`1、求出b从a删除的文件`}</p>\n    <p>{`2、并把他们加回来，提交，解决冲突。`}</p>\n    <p>{`其中1这个步骤我们可以以一种反向思维去做。先`}<inlineCode parentName=\"p\">{`git checkout`}</inlineCode>{`到b，然后`}<inlineCode parentName=\"p\">{`git reset --soft`}</inlineCode>{`到a，这样，工作区就出现了被删掉的文件，直接将其提交即可。`}</p>\n    <p>{`这是什么原理呢？我们这样来理解一下。`}</p>\n    <p>{`首先，假如先checkout到a，然后reset到b，那么工作区暂存的就是`}<inlineCode parentName=\"p\">{`b删掉的文件`}</inlineCode>{`。`}</p>\n    <p>{`咱们反过来操作，先checkout到b，然后reset到a，那么工作区暂存的就是`}<inlineCode parentName=\"p\">{`revert b删掉的文件`}</inlineCode>{`即加回来这些文件。`}</p>\n    <p>{`其实，reset —soft做了什么呢？`}</p>\n    <p><inlineCode parentName=\"p\">{`reset --soft 会在重置 HEAD 和 branch 时，保留工作目录和暂存区中的内容，并把重置 HEAD 所带来的新的差异放进暂存区。`}</inlineCode>{`。`}</p>\n    <p>{`理解了这句话。差异是`}<inlineCode parentName=\"p\">{`before - after`}</inlineCode>{`。那么我们带入a和b`}<inlineCode parentName=\"p\">{`before:b, after:a`}</inlineCode>{`，这个差异就是`}<inlineCode parentName=\"p\">{`b-a=被删的文件加回来`}</inlineCode></p>\n    <p>{`步骤2的操作可以用`}<inlineCode parentName=\"p\">{`git pull -r`}</inlineCode>{`将本地提交追加到最新，并解决冲突即可。`}</p>\n    <h3 {...{\n      \"id\": \"反思\"\n    }}>{`反思`}</h3>\n    <p>{`1、预防：CR要仔细，发现有大量文件别通过，仔细核对。`}</p>\n    <p>{`2、错误已经发生，要沉着冷静。有时候正向走不通，可以考虑反向操作，会有意想不到的效果。`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"你可以从本文了解到\",\n    level: 2,\n    title: \"你可以从本文了解到\",\n    children: [\n        {\n              id: \"背景\",\n              level: 3,\n              title: \"背景\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"问题分析和方案比较\",\n              level: 3,\n              title: \"问题分析和方案比较\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"反思\",\n              level: 3,\n              title: \"反思\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","module.exports = __webpack_public_path__ + \"static/media/1.9413fe76.png\";"],"sourceRoot":""}