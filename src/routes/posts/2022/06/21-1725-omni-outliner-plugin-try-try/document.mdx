## ä½ å¯ä»¥ä»æœ¬æ–‡äº†è§£åˆ°

### èƒŒæ™¯

ä¹ æƒ¯æ˜¯ä¸€ä¸ªäººçš„è¿­ä»£ç³»ç»Ÿï¼Œå¥½çš„ä¹ æƒ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ç”Ÿæ´»å’Œå·¥ä½œä¸­æ›´å¥½çš„æˆé•¿ã€‚

æˆ‘å¹³æ—¶æœ‰è®°å·¥ä½œæ—¥å¿—çš„ä¹ æƒ¯ï¼ŒOmin Outlineræ˜¯ä¸€æ¬¾å¤§çº²è½¯ä»¶ï¼Œèƒ½å¤Ÿå®ç°ä»»æ„å±‚çº§æ·±åº¦çš„ç»“æ„ï¼Œç”¨äºè®°å½•å·¥ä½œäº‹é¡¹å’Œå¤ç›˜éƒ½éå¸¸æ–¹ä¾¿ã€‚

æˆ‘å¹³æ—¶çš„æ—¥å¿—ä¸»è¦ä¸‹é¢è¿™æ ·çš„ç»“æ„ã€‚


å¯ä»¥ç®€åŒ–æˆ

```
2022-10 ã€æœˆã€‘
	10.3-10.7 ã€å‘¨ã€‘
		10.3ã€æ—¥ã€‘
		10.4ã€æ—¥ã€‘
		10.5ã€æ—¥ã€‘
		10.6ã€æ—¥ã€‘
		10.7ã€æ—¥ã€‘
			TOP3ã€ä¸‰ä»¶æœ€é‡è¦çš„äº‹ã€‘
			ğŸ§™â€â™€ï¸ğŸŸã€å­¦åˆ°çš„æ–°çŸ¥è¯†ã€‘
```

æ•´ä½“çœ‹ä¸Šå»æ˜¯éå¸¸ç»“æ„åŒ–ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åŒ–çš„ã€‚

ä¹‹å‰æˆ‘éƒ½æ˜¯ä½æ•ˆç‡çš„æ‰‹åŠ¨å½•å…¥æ¯å‘¨ï¼Œä¹‹å‰ä¸€ç›´å°±åœ¨æƒ³ç­‰æœ‰ç©ºäº†ä¸€å®šè¦è‡ªåŠ¨åŒ–ã€‚

é‚£ä¹ˆæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ã€‚

### åŸºæœ¬æ¦‚å¿µ

#### 1ã€æ–‡æ¡£

é¦–å…ˆOOçš„æ–‡æ¡£æ•´ä½“çš„åŸºæœ¬æ¦‚å¿µå¯ä»¥å‚è€ƒ[å®˜ç½‘](https://omni-automation.com/omnioutliner/item.html)ï¼Œå’±ä»¬ä¸»è¦æ˜¯ç”¨åˆ°2ä¸ªæ¦‚å¿µã€‚

1ã€Documentï¼Œå³æ•´ä¸ªæ–‡ä»¶

2ã€Itemï¼Œç”¨æˆ·é€‰ä¸­çš„èŠ‚ç‚¹æˆ–èŠ‚ç‚¹ç»„



#### 2ã€æ’ä»¶

OOçš„æ’ä»¶æ˜¯å†™åœ¨ä¸€ä¸ªIIFEä¸­ï¼Œè¿”å›çš„å°±æ˜¯è¿™ä¸ªactionï¼ŒOOä¼šå°†é¡¶éƒ¨æ³¨é‡Šçš„å†…å®¹å’Œè¿™æ®µæ’ä»¶ä»£ç è¿›è¡Œå…³è”ï¼Œæ¯”å¦‚å¢åŠ èœå•å’Œå¿«æ·å…¥å£ç­‰ã€‚

```js
/*{
    "author": "mzvast",
    "targets": ["omnioutliner"],
    "type": "action",
    "identifier": "com.mycompany.createPlanFromMonth",
    "version": "0.1",
    "description": "A plug-in that...",
    "label": "createPlanFromMonth",
    "mediumLabel": "createPlanFromMonth",
    "longLabel": "createPlanFromMonth",
    "paletteLabel": "createPlanFromMonth",
}*/
(() => {
    var action = new PlugIn.Action(function (selection) {
    
      // ä½ çš„ä»£ç 

    return action;
})();
```



### æ’ä»¶è®¾è®¡å’Œå®ç°

é¦–å…ˆè¿™æ˜¯[æœ€ç»ˆä»£ç ](https://github.com/mzvast/omnijs/blob/master/outliner/createPlanFromMonth.omnijs)ã€‚

æ•´ä½“å°±æ˜¯è¦åšä¸‹é¢è¿™äº›äº‹ã€‚

1ã€è¾“å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæœˆä»½ï¼Œç”Ÿæˆå·¥ä½œæ—¥æ•°æ®ç»“æ„ã€‚ç›¸å½“äºäº§ç”ŸVDOMã€‚ï¼ˆçº¯JSï¼‰

2ã€å°†ä¸Šä¸€éƒ¨ç”Ÿæˆçš„å·¥ä½œæ—¥æ•°ç»„æ’å…¥åˆ°æ–‡æ¡£ä¸­å»ã€‚ç›¸å½“äºVDOMè½¬æ¢æˆOOçš„å¯¹è±¡ã€‚ï¼ˆä½¿ç”¨OO APIï¼‰



é¦–å…ˆæ¥çœ‹ç¬¬ä¸€éƒ¨åˆ†çº¯JSä»£ç ï¼Œç”Ÿæˆå·¥ä½œæ—¥æ•°æ®ç»“æ„ï¼Œè¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯è¦æ³¨æ„å‡ ä¸ªè¾¹ç•Œæ¡ä»¶ï¼Œé—®é¢˜ä¸å¤§ã€‚

```js
 // è¾“å…¥
// 2022-06 
// è¾“å‡º
// ans = [
//     ['6.1', '6.2', '6.3'],
//     ['6.5', '6.6', '6.7', '6.8', '6.9'],
// ];
function generateCalender(itemValue) {
        const startPoint = new Date(itemValue);
        const y = startPoint.getFullYear();
        const m = startPoint.getMonth() + 1; // æœˆ
        const d = startPoint.getDate(); // æ—¥

        const ans = [];
        let tmp = [];
        while (
            startPoint.getMonth() + 1 <= m &&
            startPoint.getFullYear() === y
          // å½“å‰æ—¥æœŸè¿˜åœ¨æœ¬æœˆï¼Œç»§ç»­å¾ªç¯
        ) {
            const day = startPoint.getDay();
            if (day < 6 && day > 0) {
                tmp.push(`${m}.${startPoint.getDate()}`); // æ’å…¥å·¥ä½œæ—¥åˆ°tmp
            } else if (tmp.length) {
                ans.push(tmp); // å°†tmpæ’å…¥ans
                tmp = [];
            }
            startPoint.setDate(startPoint.getDate() + 1); // å¢åŠ ä¸€å¤©
        }

        return ans;
    }
```

ç„¶åå°±è¦å¤„ç†ç¬¬äºŒéƒ¨åˆ†äº†ã€‚ä¹Ÿæ²¡ä»€ä¹ˆå¤æ‚çš„é€»è¾‘ï¼Œçœ‹æ³¨é‡Šå°±å¯ä»¥äº†è§£ã€‚

å…³é”®æ˜¯ç”¨åˆ°å‡ ä¸ªAPI

1ã€`document.editors[0].selectedNodes`è·å–å½“å‰é€‰ä¸­çš„èŠ‚ç‚¹list

2ã€`document.outline.outlineColumn`å½“å‰focusçš„åˆ—ï¼Œä¸€è¡Œä¸€åˆ—å°±ç¡®å®šäº†å•å…ƒæ ¼

3ã€`selectedItem.valueForColumn(targetColumn).string`è·å–æŸä¸ªå•å…ƒæ ¼çš„å†…å®¹

4ã€`selectedItem.addChild`å‘ä¸€ä¸ªitemæ’å…¥å­èŠ‚ç‚¹ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ’å…¥ä½ç½®ï¼Œendè¡¨ç¤ºæ’å…¥åˆ°æœ«å°¾ã€‚



```js
/*{
    "author": "mzvast",
    "targets": ["omnioutliner"],
    "type": "action",
    "identifier": "com.mycompany.createPlanFromMonth",
    "version": "0.1",
    "description": "A plug-in that...",
    "label": "createPlanFromMonth",
    "mediumLabel": "createPlanFromMonth",
    "longLabel": "createPlanFromMonth",
    "paletteLabel": "createPlanFromMonth",
}*/
(() => {
    var action = new PlugIn.Action(function (selection) {
        var selectedItems = document.editors[0].selectedNodes.map(function (
            node
        ) {
            return node.object;
        });
				
      // åŒæ—¶æ”¯æŒå•é€‰å’Œå¤šé€‰
        selectedItems.forEach((item) => {
            processItem(item);
        });


    });
    // å¤„ç†ä¸€æ¡è®°å½•
    function processItem(selectedItem) {
     
        var targetColumn = document.outline.outlineColumn; // è·å–å½“å‰çš„åˆ—
        var itemValue = selectedItem.valueForColumn(targetColumn).string; // å½“å‰å•å…ƒæ ¼çš„å†…å®¹
        console.log('Invoked with selection', itemValue);
        // 2022-1,2022-01
      	// æ•°æ®æ ¡éªŒ
        if (!/\d{4}-\d{2}/i.test(itemValue)) {
            new Alert('bad date, expect YYYY-MM', itemValue).show(function (result) {});
            return;
        }

        // è¾“å…¥
        // 2022-06
        // getDay 0å‘¨æ—¥ 1å‘¨ä¸€..6å‘¨å…­

        const ans = generateCalender(itemValue);

        // æœ€ç»ˆçš„æ•°æ®ç»“æ„
        // ans = [
        //     ['6.1', '6.2', '6.3'],
        //     ['6.5', '6.6', '6.7', '6.8', '6.9'],
        // ];

        // renderer
        for (let i = 0; i < ans.length; i++) {
            // i=> week
            const week = selectedItem.addChild(
                selectedItem.end,
                function (item) {
                    item.topic =`${ans[i][0]}-${ans[i][ans[i].length - 1]}`;
                }
            );
            for (let j = 0; j < ans[i].length; j++) {
                const day = week.addChild(week.end, function (item) {
                    item.topic = ans[i][j];
                });

                day.addChild(day.end, function (item) {
                    item.topic = 'TOP3';
                });
                day.addChild(day.end, function (item) {
                    item.topic = 'ğŸ§™â€â™€ï¸ğŸŸ';
                });
            }
        }
    }

    function generateCalender(itemValue) {
        // ...
    }

    return action;
})();
```





### æ€»ç»“

è¿™æ¬¾æ’ä»¶åœ¨ä½¿å¾—ä¹‹åä¸ªäººå·¥ä½œæ—¥å¿—çš„è¿­ä»£æ•ˆç‡æ›´maxäº†ã€‚

å€Ÿæ­¤æœºä¼šè¿˜æ·±å…¥äº†è§£äº†OOçš„æ–‡æ¡£ç»“æ„å’ŒAPIï¼Œä»¥åå¼€å‘ç±»ä¼¼çš„æ’ä»¶å°±ä¼šæ›´å¾—å¿ƒåº”æ‰‹ã€‚

ä¹Ÿå¸Œæœ›æœ¬æ–‡å¯ä»¥å¸®åˆ°å¯¹OO æ’ä»¶æ„Ÿå…´è¶£çš„åŒå­¦ã€‚